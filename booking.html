<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ุงูุญุฌูุฒุงุช โ ูุนุฑุถ ุฃุจู ุญูุฏ ุงูุนูููู</title>

  <!-- ุฎุท -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet" />

  <!-- ุงูุชูุณููุงุช ุงููุดุชุฑูุฉ + ุชูุณููุงุช ุงูุตูุญุงุช -->
  <link rel="stylesheet" href="assets/css/main.css" />
  <link rel="stylesheet" href="assets/css/pages.css" />
</head>
<body>
  <!-- Navbar -->
  <header class="navbar">
    <div class="container row">
      <ul class="nav-links">
        <li><a href="index.html">ุงูุฑุฆูุณูุฉ</a></li>
        <li><a href="vehicles.html">ุงููุฑูุจุงุช</a></li>
        <li><a href="booking.html">ุงูุญุฌูุฒุงุช</a></li>
        <li><a href="contact.html">ุชูุงุตู ูุนูุง</a></li>
      </ul>
      <a class="btn-login" href="login.html">ุชุณุฌูู ุฏุฎูู</a>
    </div>
  </header>

  <!-- Booking -->
  <section class="section booking">
    <div class="container">
      <h1 class="section-title fade-up">ูููุฐุฌ ุงูุญุฌุฒ</h1>
      <p class="lead fade-up">ุฃููู ุจูุงูุงุชู ูุชุฃููุฏ ุงูุญุฌุฒ. (ุงูุณุนุฑ ูุงูุตูุฑุฉ ุชุชุญุฏุซ ุชููุงุฆููุง ุนูุฏ ุงุฎุชูุงุฑ ุงููุฑูุจุฉ)</p>

      <form id="bookingForm" class="form card-ux form-wide" novalidate>
        <!-- ุงููุฑูุจุฉ -->
        <div class="field">
          <label class="lbl">ุงููุฑูุจุฉ</label>
          <div class="input-wrap">
            <select id="car" name="car" class="input has-icon" required>
              <option value="" disabled selected>ุงุฎุชุฑ ุงููุฑูุจุฉ</option>
              <!-- ูุงุญุธ data-img ุชูุงูู ุตูุฑู ุงูุญุงููุฉ -->
              <option value="Hilux 2017" data-price="200" data-img="2.jpg">Hilux 2017</option>
              <option value="Hilux 2020" data-price="250" data-img="3.png">Hilux 2020</option>
              <option value="Hilux 2022" data-price="300" data-img="3.png">Hilux 2022</option>
            </select>
            <span class="icon">๐</span>
          </div>
          <small class="hint">ุงุฎุชุฑ ุงููุฑูุจุฉ ุงููุทููุจุฉ</small>
        </div>

        <!-- ุงูุณุนุฑ -->
        <div class="field">
          <label class="lbl">ุงูุณุนุฑ (ุจุงูุฏููุงุฑ)</label>
          <div class="input-wrap">
            <input id="price" name="price" class="input has-icon" type="number" inputmode="numeric" placeholder="ูุซุงู: 250" required />
            <span class="icon">$</span>
          </div>
          <small class="hint">ูุชุนุจุฃ ุชููุงุฆููุง ุจุนุฏ ุงุฎุชูุงุฑ ุงููุฑูุจุฉ ููููู ุชุนุฏููู</small>
        </div>

        <!-- ุงูุงุณู -->
        <div class="field">
          <label class="lbl">ุงูุงุณู ุงููุงูู</label>
          <div class="input-wrap">
            <input id="fullname" name="name" class="input has-icon" placeholder="ุงุณูู" required />
            <span class="icon">๐ค</span>
          </div>
        </div>

        <!-- ุงููุงุชู -->
        <div class="field">
          <label class="lbl">ุฑูู ุงููุงุชู</label>
          <div class="input-wrap">
            <input
              id="phone" name="phone" class="input has-icon" type="tel"
              placeholder="77xxxxxxx"
              pattern="^(?:\+?967)?0?7\d{8}$"
              required />
            <span class="icon">๐ฑ</span>
          </div>
          <small class="hint">ูุฏุนู: 7xxxxxxxx ุฃู 07xxxxxxxx ุฃู +9677xxxxxxxx</small>
        </div>

        <!-- ูู / ุฅูู -->
        <div class="field">
          <label class="lbl">ูู / ุฅูู</label>
          <div class="input-wrap">
            <input id="route" name="route" class="input has-icon" placeholder="ูู ุตูุนุงุก ุฅูู ุฅุจ" required />
            <span class="icon">๐</span>
          </div>
        </div>

        <!-- ุงูุชุงุฑูุฎ ูุนุฏุฏ ุงูุฑูุงุจ -->
        <div class="row-2">
          <div class="field">
            <label class="lbl">ุชุงุฑูุฎ ุงูุฑุญูุฉ</label>
            <div class="input-wrap">
              <input id="date" name="date" class="input has-icon" type="date" required />
              <span class="icon">๐</span>
            </div>
          </div>
          <div class="field">
            <label class="lbl">ุนุฏุฏ ุงูุฑูุงุจ</label>
            <div class="input-wrap">
              <input id="passengers" name="passengers" class="input has-icon" type="number" min="1" max="7" value="4" required />
              <span class="icon">๐ฅ</span>
            </div>
          </div>
        </div>

        <!-- ุฒุฑ -->
        <button class="btn submit-btn" type="submit">ุชุฃููุฏ ุงูุญุฌุฒ</button>

        <!-- ุฑุณุงุฆู -->
        <div id="formMsg" class="form-msg" aria-live="polite"></div>
      </form>
    </div>
  </section>

  <footer class="footer">
    <div class="container"><p>ยฉ 2025 ูุนุฑุถ ุงููุฑูุณู</p></div>
  </footer>

  <!-- ===== Modal: ููุฎุต ุงูุญุฌุฒ ===== -->
  <div class="modal" id="confirmModal" aria-hidden="true">
    <div class="modal-backdrop" data-close></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <button class="modal-close" aria-label="ุฅุบูุงู" data-close>ร</button>

      <div class="modal-hero">
        <!-- ุตูุฑุฉ ุงูููุฎูุต (ุชุชุญุฏุซ ุชููุงุฆููุง) -->
        <img id="mImg" src="./assets/img/2.jpg" alt="ุตูุฑุฉ ุงููุฑูุจุฉ"
             onerror="this.onerror=null; this.src='assets/img/placeholder.png'">
      </div>

      <div class="modal-body">
        <h3 id="modalTitle">ููุฎุต ุงูุญุฌุฒ</h3>

        <div class="modal-grid">
          <div><span>ุงููุฑูุจุฉ:</span> <strong id="mCar">-</strong></div>
          <div><span>ุงูุณุนุฑ:</span> <strong><span id="mPrice">-</span>$</strong></div>
          <div><span>ุงูุนููู:</span> <strong id="mName">-</strong></div>
          <div><span>ุงููุงุชู:</span> <strong id="mPhone">-</strong></div>
          <div class="full"><span>ุงููุณุงุฑ:</span> <strong id="mRoute">-</strong></div>
          <div><span>ุงูุชุงุฑูุฎ:</span> <strong id="mDate">-</strong></div>
          <div><span>ุนุฏุฏ ุงูุฑูุงุจ:</span> <strong id="mPassengers">-</strong></div>
        </div>

        <div class="modal-actions">
          <button class="btn" id="mPrint">ุทุจุงุนุฉ ุงูููุฎุต</button>
          <button class="btn btn-outline" data-close>ุฅุบูุงู</button>
        </div>

        <p class="modal-note">ุณูุชู ุงูุชูุงุตู ูุนูู ุฎูุงู ุณุงุนุงุช ุงูุนูู ูุชุฃููุฏ ุงูุญุฌุฒ ููุงุฆููุง. ุดูุฑูุง ูุงุฎุชูุงุฑูู ูุนุฑุถ ุงููุฑูุณู .</p>
      </div>
    </div>
  </div>

  <!-- ุณูุฑุจุชุงุช -->
  <script src="assets/js/main.js"></script>
  <script>
    // ุนูุงุตุฑ ุงููููุฐุฌ
    const carSel = document.getElementById('car');
    const priceInp = document.getElementById('price');
    const nameInp = document.getElementById('fullname');
    const phoneInp = document.getElementById('phone');
    const routeInp = document.getElementById('route');
    const dateInp = document.getElementById('date');
    const passInp = document.getElementById('passengers');
    const formMsg = document.getElementById('formMsg');
    const modalImg = document.getElementById('mImg');

    // ุญุฏู ุฃุฏูู ููุชุงุฑูุฎ
    dateInp.min = new Date().toISOString().split('T')[0];

    // ุฎุฑูุทุฉ ุงุญุชูุงุทูุฉ ุจูู ุงูุงุณู ูุงูุตูุฑุฉ (ูู ูุง ูุงู ูู data-img)
    const carImageMap = {
      'Hilux 2017': '2.jpg',
      'Hilux 2020': '3.png',
      'Hilux 2022': '3.png'
    };

    // ุชุญุฏูุซ ุตูุฑุฉ ุงูููุฎุต ูู ุงูู option + fallback
    function setCarImageFromOption(opt){
      let filename = opt?.dataset?.img || carImageMap[opt?.value];
      modalImg.src = filename ? `assets/img/${filename}` : `assets/img/placeholder.png`;
    }

    // ุนูุฏ ุชุบููุฑ ุงููุฑูุจุฉ: ุญุฏูุซ ุงูุณุนุฑ ูุงูุตูุฑุฉ
    function updateFromSelect(){
      const opt = carSel.selectedOptions[0];
      if (!opt) return;
      if (opt.dataset.price) priceInp.value = opt.dataset.price;
      setCarImageFromOption(opt);
    }
    carSel.addEventListener('change', updateFromSelect);

    // ูุฑุงุกุฉ ููู ูู ุงูุฑุงุจุท (vehicles -> booking)
    const url = new URLSearchParams(location.search);
    const urlCar = url.get('car');
    const urlPrice = url.get('price');

    if (urlCar) {
      const match = [...carSel.options].find(o => o.value === urlCar);
      if (match) {
        carSel.value = urlCar;
        setCarImageFromOption(match);
        if (!urlPrice && match.dataset.price) priceInp.value = match.dataset.price;
      }
    }
    if (urlPrice) priceInp.value = urlPrice;

    // ุชุญููู ุงูุฃุฑูุงู ุงูุนุฑุจูุฉ/ุงูููุฏูุฉ ุฅูู ุฅูุฌููุฒูุฉ
    function normalizeDigits(str){
      const ar = 'ููกูขูฃูคูฅูฆูงูจูฉ', inD = 'ฐฑฒณดตถทธน';
      return String(str)
        .replace(/[ู-ูฉ]/g, d => ar.indexOf(d))
        .replace(/[ฐ-น]/g, d => inD.indexOf(d));
    }
    // ุชุญูู ูุฑู ูุฃุฑูุงู ุงูููู
    function isValidYemenMobile(raw){
      const s = normalizeDigits(raw).replace(/\s|-/g,'');
      return /^(?:\+?967)?0?7\d{8}$/.test(s);
    }

    // ููุทู ุงูููุฏุงู
    const modal = document.getElementById('confirmModal');
    function openModal(){ modal.setAttribute('aria-hidden','false'); modal.classList.add('show'); document.body.style.overflow='hidden'; }
    function closeModal(){ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
    modal.addEventListener('click', (e)=> { if (e.target.hasAttribute('data-close')) closeModal(); });
    document.addEventListener('keydown', (e)=> { if (e.key === 'Escape') closeModal(); });

    // ุฅุฑุณุงู ุงููููุฐุฌ -> ุนุฑุถ ููุฎูุต ูุน ุตูุฑุฉ ุตุญูุญุฉ
    document.getElementById('bookingForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      formMsg.textContent = '';

      if (!carSel.value) return showMsg('ูุฑุฌู ุงุฎุชูุงุฑ ุงููุฑูุจุฉ', 'err');
      if (!priceInp.value || Number(priceInp.value) <= 0) return showMsg('ุชุญูู ูู ุงูุณุนุฑ', 'err');
      if (!isValidYemenMobile(phoneInp.value)) return showMsg('ุฑูู ุงููุงุชู ุบูุฑ ุตุญูุญ', 'err');

      const opt = carSel.selectedOptions[0];
      setCarImageFromOption(opt);

      // ุชุนุจุฆุฉ ุจูุงูุงุช ุงูููุฏุงู
      document.getElementById('mCar').textContent = carSel.value;
      document.getElementById('mPrice').textContent = priceInp.value || '-';
      document.getElementById('mName').textContent = nameInp.value.trim() || '-';
      document.getElementById('mPhone').textContent = normalizeDigits(phoneInp.value.trim()) || '-';
      document.getElementById('mRoute').textContent = routeInp.value.trim() || '-';
      document.getElementById('mDate').textContent = dateInp.value || '-';
      document.getElementById('mPassengers').textContent = passInp.value || '-';

      openModal();
    });

    function showMsg(txt, type){
      formMsg.textContent = txt;
      formMsg.className = 'form-msg ' + (type==='ok' ? 'ok' : 'err');
    }

    // ุทุจุงุนุฉ ุงูููุฎุต
    document.getElementById('mPrint').addEventListener('click', () => window.print());

    // ุชุญุฏูุซ ูุจุฏุฆู ุฅู ูู ูุฃุชู ูู ุฑุงุจุท
    if (!urlCar) updateFromSelect();
  </script>
</body>
</html>
